<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ZoyBlocks — Protótipo Game (Phaser 3)</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
  <style>
    html,body{height:100%;margin:0;font-family:Arial,Helvetica,sans-serif}
    #game-container{width:100%;height:100vh;display:block}

    /* Botão voltar */
    #backButton {
      position: fixed;
      bottom: 12px;
      left: 12px;
      background: rgba(255,255,255,0.95);
      color: #222;
      font-weight: bold;
      border: 2px solid #444;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      z-index: 1000;
      transition: all 0.2s ease;
    }

    #backButton:hover {
      background: #f1f1f1;
      transform: translateY(-2px);
      box-shadow: 0 6px 14px rgba(0,0,0,0.3);
    }

    /* Modal/Oráculo */
    #oracleOverlay{
      position:fixed;left:0;top:0;width:100%;height:100%;
      display:flex;align-items:center;justify-content:center;
      background:rgba(0,0,0,0.5);z-index:999;visibility:hidden;
    }
    #oracleCard{
      background:#fff;padding:20px;border-radius:8px;
      max-width:520px;width:92%;box-shadow:0 6px 18px rgba(0,0,0,0.25)
    }
    #oracleCard h2{margin:0 0 8px 0}
    #oracleOptions{display:flex;flex-direction:column;gap:8px;margin-top:12px}
    .optBtn{
      padding:10px;border-radius:6px;border:1px solid #ccc;
      background:#f7f7f7;cursor:pointer;text-align:left
    }
    .optBtn:hover{background:#eee}
    #oracleFooter{margin-top:12px;font-size:13px;color:#444}

    /* Top info */
    #infoBar{
      position:fixed;left:12px;top:12px;z-index:900;
      background:rgba(255,255,255,0.9);padding:8px 12px;
      border-radius:6px;box-shadow:0 3px 8px rgba(0,0,0,0.12)
    }
    #infoBar b{margin-right:6px}

  /* Disciplina selector centralizado com tema Electron */
#disciplinaSelector {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 900;
  width: 320px;
  background: linear-gradient(145deg, #2c2f33, #23272a); /* fundo escuro gradiente estilo Electron */
  color: #ffffff;
  padding: 24px 32px;
  border-radius: 14px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.05);
  text-align: center;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* Título */
#disciplinaSelector h2 {
  margin-bottom: 20px;
  font-size: 22px;
  font-weight: 600;
  color: #f5f5f5;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
}

/* Botões */
#disciplinaSelector button {
  display: block;
  width: 100%;
  margin: 8px 0;
  padding: 10px 0;
  font-size: 16px;
  font-weight: 500;
  border-radius: 8px;
  border: none;
  background: #7289da; /* azul suave estilo Electron */
  color: #fff;
  cursor: pointer;
  transition: all 0.2s ease;
}

#disciplinaSelector button:hover {
  background: #677bc4;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
}

  </style>
</head>
<body>

  <!-- Botão Voltar -->
  <div id="backButton" onclick="goBackToMenu()">⬅ Voltar</div>

  <!-- Seletor de disciplina -->
  <div id="disciplinaSelector">
    <h2>Escolha uma disciplina</h2>
    <button onclick="window.zoyHelpers.loadDisciplina('matematica')">Matemática</button>
    <button onclick="window.zoyHelpers.loadDisciplina('portugues')">Português</button>
    <button onclick="window.zoyHelpers.loadDisciplina('robotica')">Robótica</button>
  </div>

  <!-- Container do Phaser -->
  <div id="game-container"></div>

  <!-- Barra de informações -->
  <div id="infoBar">
    <b>Modo:</b> Iniciação — <span id="scoreDisplay">Score: 0</span>
  </div>

  <!-- Modal Oráculo -->
  <div id="oracleOverlay" role="dialog" aria-hidden="true">
    <div id="oracleCard">
      <h2 id="oracleTitle">Oráculo da Robótica</h2>
      <div id="oracleQuestion">Pergunta...</div>
      <div id="oracleOptions"></div>
      <div id="oracleFooter"></div>
    </div>
  </div>

  <script src="zoy_quiz.js"></script>

  <script>
    /* ---------------------------
       Protótipo Phaser 3 — Zoy Game
    ----------------------------*/
    function goBackToMenu(){
      if(window.electronAPI?.navigateTo){
        window.electronAPI.navigateTo('menu');
      } else {
        window.location.href = 'zoy_jogos.html';
      }
    }

    // Base de perguntas
    const QUESTIONS = [
      {id:1, question:'O que faz um resistor em um circuito elétrico?', options:['Armazena carga elétrica','Limita a corrente elétrica'], answer:1, explanation:'Resistores limitam a corrente e dissipam energia em forma de calor.'},
      {id:2, question:'Qual componente é usado para controlar a velocidade de um motor DC em PWM?', options:['Transistor / MOSFET','Condensador eletrolítico'], answer:0, explanation:'Transistores/MOSFETs são usados como chaves para modular a potência do motor (PWM).'},
      {id:3, question:'Qual dispositivo serve para medir distância sem contato usando ultrassom?', options:['Sensor IR','Sensor ultrassônico HC-SR04'], answer:1, explanation:'O HC-SR04 mede distância por emissão e recepção de ondas ultrassônicas.'}
    ];

    // Parâmetros do jogo
    const MODE = {name:'Iniciação', doors:2, pointsPerDoor:5};
    let gameSceneRef = null;
    let currentQuestion = null;
    let currentDoorObj = null;
    let score = Number(localStorage.getItem('zoy_score') || 0);
    document.getElementById('scoreDisplay').innerText = 'Score: ' + score;

    // Previne fechamento ao clicar fora do modal
    document.getElementById('oracleOverlay').addEventListener('click', e=>{
      if(e.target === document.getElementById('oracleOverlay')) e.stopPropagation();
    });

    function openOracleForDoor(scene, doorObj){
      currentQuestion = QUESTIONS[Math.floor(Math.random()*QUESTIONS.length)];
      currentDoorObj = doorObj;
      gameSceneRef = scene;
      showOracleModal(currentQuestion);
      scene.physics.world.pause();
    }

    function showOracleModal(q){
      const overlay = document.getElementById('oracleOverlay');
      const qEl = document.getElementById('oracleQuestion');
      const opts = document.getElementById('oracleOptions');
      const footer = document.getElementById('oracleFooter');
      qEl.innerText = q.question;
      opts.innerHTML = '';
      q.options.forEach((optText, idx)=>{
        const btn = document.createElement('button');
        btn.className = 'optBtn';
        btn.innerText = optText;
        btn.onclick = ()=>handleAnswer(idx);
        opts.appendChild(btn);
      });
      footer.innerText = 'Escolha uma opção para o Oráculo avaliar.';
      overlay.style.visibility='visible';
      overlay.setAttribute('aria-hidden','false');
    }

    function closeOracleModal(){
      const overlay = document.getElementById('oracleOverlay');
      overlay.style.visibility='hidden';
      overlay.setAttribute('aria-hidden','true');
    }

    function handleAnswer(selectedIndex){
      const footer = document.getElementById('oracleFooter');
      if(selectedIndex===currentQuestion.answer){
        footer.innerText='✅ Correto! '+currentQuestion.explanation;
        if(currentDoorObj && !currentDoorObj.opened){
          currentDoorObj.opened=true;
          score+=MODE.pointsPerDoor;
          localStorage.setItem('zoy_score',score);
          document.getElementById('scoreDisplay').innerText='Score: '+score;
          if(gameSceneRef){
            gameSceneRef.time.delayedCall(800, ()=>{
              try{ gameSceneRef.physics.world.remove(currentDoorObj.body); }catch(e){}
            });
            if(currentDoorObj.setFillStyle) currentDoorObj.setFillStyle(0x2ecc71);
          }
        }
      } else {
        footer.innerText='❌ Errado. Dica: '+currentQuestion.explanation;
      }
      setTimeout(()=>{
        closeOracleModal();
        if(gameSceneRef) gameSceneRef.physics.world.resume();
      },1200);
    }

    /* ------------------ Phaser config and scene ------------------ */
    const config = {
      type: Phaser.AUTO,
      parent: 'game-container',
      width: 960,
      height: 640,
      backgroundColor: '#87ceeb',
      physics: { default:'arcade', arcade:{debug:false} },
      scene: { preload, create, update }
    };
    const game = new Phaser.Game(config);

    function preload(){}
    let player;
    function create(){
      const scene=this;
      window._zoy_scene = scene;
      player=this.add.rectangle(120,320,40,40,0x222222);
      this.physics.add.existing(player);
      player.body.setCollideWorldBounds(true);
      player.body.setSize(40,40);

      // portas
      this.doors=[];
      const startY=200, gap=160;
      for(let i=0;i<MODE.doors;i++){
        const y=startY+i*gap;
        const door=this.add.rectangle(760,y,64,120,0x8B4513);
        this.physics.add.existing(door,true);
        door.isDoor=true;
        door.opened=false;
        door.doorId=i+1;
        this.doors.push(door);
      }

      this.doors.forEach(d=>{
        this.physics.add.overlap(player,d,(p,dObj)=>{
          if(!dObj.opened) openOracleForDoor(scene,dObj);
        });
      });

      this.physics.world.setBounds(0,0,960,640);
      this.cursors=this.input.keyboard.createCursorKeys();
      this.add.text(12,610,'Use as setas do teclado para mover o Zoy. Vá até uma porta para o Oráculo.',{fontSize:'14px',color:'#000'});
    }

    function update(time,delta){
      const speed=220;
      if(!this.cursors || !player) return;
      player.body.setVelocity(0);
      if(this.cursors.left.isDown) player.body.setVelocityX(-speed);
      if(this.cursors.right.isDown) player.body.setVelocityX(speed);
      if(this.cursors.up.isDown) player.body.setVelocityY(-speed);
      if(this.cursors.down.isDown) player.body.setVelocityY(speed);
    }

    // Helpers para debug/console
    window.zoyHelpers = {
      resetScore: ()=>{score=0; localStorage.setItem('zoy_score',0); document.getElementById('scoreDisplay').innerText='Score: 0'; location.reload();},
      setModeToEnem: ()=>{MODE.name='ENEM'; MODE.doors=10; MODE.pointsPerDoor=1; alert('Modo alterado para ENEM — recarregue a página para ver 10 portas.');},
      loadDisciplina: (disc)=>{alert('Carregar disciplina: '+disc);}
    };
  </script>

</body>
</html>
